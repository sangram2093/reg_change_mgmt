<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Compare Regulatory Graphs</title>
  <script src="https://unpkg.com/neovis.js@2.0.2"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      height: 100%;
      overflow: hidden;
    }
    h1 {
      text-align: center;
      padding: 10px 0;
      background-color: #f7f7f7;
      margin: 0;
      font-size: 20px;
    }
    .graph-row {
      display: flex;
      height: 60vh;
    }
    .graph-box {
      width: 50%;
      height: 100%;
      border: 1px solid #ccc;
    }
    .delta-section {
      height: 40vh;
      padding: 20px;
      overflow-y: auto;
    }
    pre {
      background-color: #f4f4f4;
      padding: 10px;
      border-radius: 6px;
      border: 1px solid #ddd;
      overflow-x: auto;
      max-height: 100%;
    }
  </style>
</head>
<body>

  <h1>Regulatory Change Comparison</h1>

  <div class="graph-row">
    <div class="graph-box" id="oldViz"></div>
    <div class="graph-box" id="newViz"></div>
  </div>

  <div class="delta-section">
    <h2>Detected Changes (Delta)</h2>
    <pre>{{ delta_summary }}</pre>
  </div>

  <script>
    function renderGraph(containerId, versionLabel) {
      const config = {
        containerId: containerId,
        neo4j: {
          serverUrl: "bolt://localhost:7687",
          serverUser: "neo4j",
          serverPassword: "your_password" // 🔁 replace with your Neo4j password
        },
        labels: {
          Entity: {
            caption: "name",   // ✅ use static key for testing
            size: "pagerank",
            community: "type"
          }
        },
        relationships: {
          ACTION: {
            caption: "name",
            thickness: "confidence_score"
          }
        },
        initialCypher: `
          MATCH (a:Entity {version: '${versionLabel}'})-[r:ACTION]->(b:Entity {version: '${versionLabel}'})
          RETURN a, r, b
        `
      };

      const viz = new NeoVis.default(config);
      viz.render();

      // Log after 3 seconds for inspection
      setTimeout(() => {
        console.log("🧠 Data in:", containerId);
        console.log(viz._data);
      }, 3000);
    }

    window.onload = function () {
      renderGraph("oldViz", "old");
      renderGraph("newViz", "new");
    };
  </script>

</body>
</html>
